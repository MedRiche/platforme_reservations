<div class="page">
  <!-- Bouton menu -->
  <button class="toggle-button" (click)="toggleSidebar()">‚ò∞ Menu</button>

  <!-- Sidebar -->
  <div class="sidebar" *ngIf="showSidebar">
    <button class="btn btn-primary w-100 mb-2" routerLink="/profil">üë§ Mon Profil</button>
    <button class="btn btn-primary w-100" routerLink="/mes-reservations">üìÖ Mes R√©servations</button>
  </div>

  <!-- Contenu principal -->
  <div class="main-content container mt-4">
    <h2 class="text-center">Liste des Espaces Disponibles</h2>

    <!-- Filtres -->
    <div class="row mb-3">
      <div class="col-md-5">
        <input type="text" class="form-control" placeholder="Filtrer par entreprise"
               [(ngModel)]="filtreEntreprise" (input)="applyFilter()" />
      </div>
      <div class="col-md-5">
        <select class="form-control" [(ngModel)]="filtreType" (change)="applyFilter()">
          <option value="">Tous les types</option>
          <option value="salle">Salle</option>
          <option value="bureau">Bureau</option>
          <option value="coworking">Coworking</option>
          <option value="Amphi">Amphi</option>
          <option value="hotel">H√¥tel</option>
          <option value="restaurant">Restaurant</option>
          <option value="autre">Autre</option>
        </select>
      </div>
    </div>

    <!-- Liste des espaces -->
    <div *ngIf="filteredEspaces.length > 0; else noEspaces" class="row">
      <div class="col-md-4 mb-4" *ngFor="let espace of filteredEspaces">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">{{ espace.nom }}</h5>
            <p><strong>Type :</strong> {{ espace.type }}</p>
            <p><strong>Capacit√© :</strong> {{ espace.capacite }} personnes</p>
            <p><strong>Localisation :</strong> {{ espace.localisation }}</p>
            <p><strong>Disponible :</strong>
              <span [ngClass]="{ 'text-success': espace.disponibilite, 'text-danger': !espace.disponibilite }">
                {{ espace.disponibilite ? 'Oui' : 'Non' }}
              </span>
            </p>
            <p><strong>Prix/h :</strong> {{ espace.prixParHeure }} TND</p>
            <p><strong>Description :</strong> {{ espace.description }}</p>
            <p><strong>Entreprise :</strong> {{ espace.entreprise }}</p>
            <button class="btn btn-outline-primary mt-2" (click)="openDetails(espace)">D√©tails</button>
            <button class="btn btn-outline-secondary mt-2"  (click)="openImageModal(espace)">Voir Image</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Aucun espace -->
    <ng-template #noEspaces>
      <div class="alert alert-warning text-center mt-3">
        Aucun espace trouv√© avec les filtres s√©lectionn√©s.
      </div>
    </ng-template>

    <!-- Modal Image -->
<div class="modal-backdrop" *ngIf="imageModalVisible"
     style="position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:1100; display:flex; align-items:center; justify-content:center;">
  <div class="modal-dialog" style="max-width:600px; margin:auto;">
    <div class="modal-content bg-white">
      <div class="modal-header">
        <h5 class="modal-title">Image de l'espace</h5>
        <button class="btn-close" (click)="closeImageModal()"></button>
      </div>
      <div class="modal-body text-center">
        <img [src]="imageToShow" alt="Image espace" class="img-fluid rounded" />
      </div>
    </div>
  </div>
</div>


    <!-- Modal d√©tails + calendrier -->
    <div class="modal-backdrop" *ngIf="selectedEspace"
         style="position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:1050">
      <div class="modal-dialog modal-xl" style="margin:40px auto;">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">{{ selectedEspace.nom }} - D√©tails & Calendrier</h5>
            <button class="btn-close" (click)="closeDetails()"></button>
          </div>
          <div class="modal-body">
            <div class="row mb-3">
              <!-- Infos -->
              <div class="col-md-6">
                <p><strong>Type :</strong> {{ selectedEspace.type }}</p>
                <p><strong>Capacit√© :</strong> {{ selectedEspace.capacite }} personnes</p>
                <p><strong>Localisation :</strong> {{ selectedEspace.localisation }}</p>
                <p><strong>Disponible :</strong> {{ selectedEspace.disponibilite ? 'Oui' : 'Non' }}</p>
                <p><strong>Prix/h :</strong> {{ selectedEspace.prixParHeure }} TND</p>
                <p><strong>Description :</strong> {{ selectedEspace.description }}</p>
                <p><strong>Entreprise :</strong> {{ selectedEspace.entreprise }}</p>
              </div>

              <!-- Calendrier -->
              <div class="col-md-6">
                <div style="min-height:320px;">
                  <full-calendar [options]="calendarOptions"></full-calendar>
                </div>
              </div>
            </div>

            <hr />

            <!-- Formulaire r√©servation -->
            <div class="mt-3">
              <h6>Cr√©er une r√©servation manuelle</h6>
              <form (ngSubmit)="createReservationFromSelection()">
                <div class="row">
                  <div class="col-md-4">
                    <label>Date</label>
                    <input type="date" class="form-control" [(ngModel)]="reservation.date" name="date" required />
                  </div>
                  <div class="col-md-3">
                    <label>Heure d√©but</label>
                    <input type="time" class="form-control" [(ngModel)]="reservation.heureDebut" name="heureDebut" required />
                  </div>
                  <div class="col-md-3">
                    <label>Heure fin</label>
                    <input type="time" class="form-control" [(ngModel)]="reservation.heureFin" name="heureFin" required />
                  </div>
                  <div class="col-md-2 d-flex align-items-end">
                    <button class="btn btn-success w-100" type="submit">R√©server</button>
                  </div>
                </div>
              </form>

              <div *ngIf="message" class="alert alert-info mt-2">{{ message }}</div>
            </div>

          </div>
        </div>
      </div>
    </div>

  </div>
</div>

